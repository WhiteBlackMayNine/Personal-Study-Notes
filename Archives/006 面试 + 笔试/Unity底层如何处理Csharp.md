---
aliases:
  - Unity3D字节跳动面试题
tags: 
created: 2024-03-21
来源: https://www.bilibili.com/video/BV1JJ4m1a7MH
---

---
# 面试题目

【Unity3D字节跳动面试题】Unity底层如何处理C#

---
# 考点分析

`.net` mono 虚拟机 是什么
为什么有虚拟机 还推出了`il2cpp` 
`.net` mono 虚拟机 与 `il2cpp` 的优缺点


---
# 面试答案

## Unity 的历史里面为什么会选择使用 Mono 

Mono 其实是微软 `.net` 标准开放以后，Mono 是一个跨平台的`.net`项目（支持 Window，Linux，Mac，Ios，Android）

基于 Mono 来开发应用，开发游戏引擎，打包发布我们的产品，都是可以进行跨平台的

Unity 在设计的时候，为了跨平台，就使用 Mono 来作为构建 Untiy 的一个底层 

能够快速实现，Unity 编辑器 以及 Unity 开发出来的项目可以跨平台

## Unity 又会推出 `il2cpp` 

Mono 的 `.net` 版权问题 

Mono 虚拟机 解释执行 `.net` 字节码 的运行效率也是差一些的

有些平台不允许内置`.net`虚拟机，比如 IOS 

**如果有新的计算平台出来，但 Mono 又不支持，这个时候 Unity 的跨平台就要歇菜了 
**整个 Mono 是另外一个项目的，如果把 Mono 虚拟机 移植到 一个新的平台上，可能需要 Unity 自己手动进行
这个时候就会和 Mono 的 主干分开，导致 Mono 一个分支 ，Unity 一个分支，后期维护非常麻烦 
且一下平台也不好移植，比如 web 平台

## 什么叫做`il2cpp` 

为了解决上面的四个问题，Unity会做一些 `il2xxx` 的技术

IL：值`.net`的字节码 

`il2cpp`：将`.net`的字节码转为C++代码，然后在编译，生成 native 平台相关的一些东西

此时，Unity 会做一些事情 
- Unity 使用 C/C++以及 native 的开发，做一个跨平台的 runtime （**程序运行时的环境或系统**）
- Unity 引擎 与 开发者的代码 生成的 `.net` 字节码，开发出一个工具来，即`il2cpp`，转成C++代码 
- C++ 代码会依赖于 runtime ，会基于这一层 runtime 来做打包和发布，会基于里面的库进行一个编译 
- 最终，C++代码会联合这些跨平台 runtime 与其中的工具一起编译 
- 然后生成出来这个目标平台的这个应用程序  

注意
- C#是有 [[4 构造、析构、垃圾回收机制]] 垃圾回收机制的
- C++代码就需要对这些垃圾回收等提供支持
- Unity 为了能够支持 C# 的一些特性，开发了 `il2cpp vm`（ runtime ）
	- 里面支持了 C#`.net` 里面独有的一些特性，比如垃圾回收

## `il2cpp`到底做了什么事情，有哪些优势

跨平台可移植性问题 
- Unity 只需要移植出`il2cpp`就可以了，只需要解决一些跨平台对应的接口
	- 同时也解决了`.net`的版本问题 
- 性能获得提升
	-  `.net` 毕竟是个 解释执行字节码，但`il2cpp`将其变为了 C++ 代码（其实就是本地的 native 代码） 

基本上都是基于`il2cpp`进行发布的——>性能会更好

## `il2xxx` 

可以基于 `il2cpp` 再把 IL 字节码 转为其他平台下 做跨平台移植的时候就会比 Mono 方便许多 

同时都是基于 C# 开发的，可以做到 一次开发 ，N个平台 都可以运行



---

