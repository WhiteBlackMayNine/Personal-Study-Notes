---
tags:
  - 科学/编程语言/Csharp/唐老狮/进阶/协变逆变
created: 2024-03-22
课时: "35"
来源: https://www.taikr.com/course/1144/task/36052/show
备注: 实际上用的少，但面试可能会问
---

---
# 关联知识点



---
# 知识点

## 什么是协变逆变

### 协变

- 和谐的变化，自然的变化
- 因为 里氏替换原则 父类可以装子类
- 所以 子类变父类
- 比如 `string` 变成 `object`
- 感受是和谐的
### 逆变

- 逆常规的变化，不正常的变化
- 因为 里氏替换原则 父类可以装子类
- 所以 父类变子类
- 比如 `object` 变成 `string
- 感受是不和谐的
- 但是子类不能装父类
### 协变和逆变是用来修饰泛型的

- 协变 `out
- 逆变 `in
- 用于在泛型中 修饰 泛型字母的
- 只有泛型接口和泛型委托能使用
	- 类和结构体不能使用
## 作用

### 返回值和参数

#### 用 `out` 修饰的泛型，只能作为返回值

- `delegate T TestOut<out T>();`
	- 此时再将 T 作为参数会报错
#### 用 `in` 修饰的泛型，只能作为参数

- `delegate void TestIn<in T>(T t);`
	- 此时再将 T 作为返回值会报错
### 结合里氏替换原则理解

####协变 父类总是能被子类替换

- `TestOut<Son> os = ()=>{ return new Son();};`
- `TestOut<Father> of = os;`
- `Father f = of();`
	- 实际上，返回的是 `os`里面装的函数，返回的是 `Son`
	- **用父类泛型委托，装载了子类泛型委托（父类装子类）
- `out` 会自动根据里氏替换原则判断返回值有没有父子关系
- 看起来就是 `son ——> father`
#### 逆变 父类总是能被子类替换
- `TestIn<Father> = (value)=> { };`
- `TestIn<Son> is = iF;`
- `is(new Son());` 实际上 调用的是 `iF`
- 看起来是 `father ——> son` 明明是传父类，但却是传子类，不和谐
	- **用子类泛型委托装载父类泛型委托（子类装父类）

## 协变逆变 更多体现在**委托容器装载**中

---
# 总结

- 关键字
	- 协变 `out
	- 逆变 `in
	- 用来修饰 泛型替代符的 只能修饰接口和委托中的泛型
- 作用两点
	- `out`修饰的泛型类型 只能作为返回值类型 `in`修饰的泛型类型 只能作为 参数类型
	- 遵循里氏替换原则的 用`out`和`in`修饰的 泛型委托 可以相互装载（有父子关系的泛型）
- 协变 父类泛型委托装子类泛型委托
- 逆变 子类泛型委托装父类泛型委托

---
# 源代码

![[协变逆变知识点.cs]]

---
# 练习题

![[协变逆变练习题.cs]]

---
