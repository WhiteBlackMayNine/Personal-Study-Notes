---
tags:
  - 科学/Unity/唐老师/Unity核心/3D动画相关/状态机行为脚本
created: 2024-03-30
课时: "86"
---

---
# 关联知识点



---
# 知识点
## 状态机行为脚本是什么

- 状态机行为脚本是一类特殊的脚本
	- 继承指定的基类
- 它主要用于关联到状态机中的状态矩形上
- 我们可以按照一定规则编写脚本
- 当进入、退出、保持在某一个特定状态时我们可以进行一些逻辑处理
### 简单解释

- 就是为 Animator Controller 状态机窗口中的某一个状态添加一个脚本
- 利用这个脚本我们可以做一些特殊功能
	- 比如
		- 进入或退出某一状态时播放声音
		- 仅在某些状态下检测一些逻辑，比如是否接触地面等等
		- 激活和控制某些状态相关的特效
## 如何使用状态机脚本

### 步骤

- 新建一个脚本继承 StateMachineBehaviour 基类
- 实现其中的特定方法进行状态行为监听
- 处理对应逻辑
### 参数
 
- OnStateEnter    
	- 进入状态时
	- 第一个 Update 中调用
- OnStateExit     
	- 退出状态时
	- 最后一个 Update 中调用
- OnStateIK       
	- OnAnimatorIK 后调用
- OnStateMove     
	- OnAnimatorMove 后调用
- OnStateUpdate   
	- 除第一帧和最后一帧，每个 Update 上调用
- OnStateMachineEnter     
	- 子状态机进入时调用，第一个 Update 中调用
- OnStateMachineExit      
	- 子状态机退出时调用，最后一个 Update 中调用
### 注意

- 需要在状态机中，先点击创建一个脚本
	- `Add Behaviuor`
- Mono 的生命周期函数可以删掉（没有用）
	- 使用上述参数进行逻辑处理
- 函数在 StateMachineBehaviour 基类中是虚函数，需要重新
	- 此时需要使用 `Debug.Log()` 进行打印
- 如有需要，`state`使用点运算符查看
- `stateInfo.IsName("状态名")`
	- 判断是否进入了某一个状态
## 状态机行为脚本和动画事件如何选择

- 状态机行为脚本相对动画事件来说更准确
- 但是使用起来稍微麻烦一些
- **根据实际需求选择使用
### 注意

- 可以单独写一个脚本
- 里面全部都是音效播放的信息
- 然后声明一个公共变量，进行通用的处理

---
# 源代码

![[状态机行为脚本 知识点.cs]]

![[状态机行为脚本 知识点_StateMachineBehaviour.cs]]

---
